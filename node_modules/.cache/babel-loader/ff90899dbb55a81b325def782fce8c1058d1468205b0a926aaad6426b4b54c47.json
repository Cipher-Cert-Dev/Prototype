{"ast":null,"code":"import _regeneratorRuntime from \"D:/CC/Server/prototype/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"D:/CC/Server/prototype/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"D:/CC/Server/prototype/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"D:/CC/Server/prototype/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nexport var Event = /*#__PURE__*/function (_trigger2) {\n  function Event() {\n    _classCallCheck(this, Event);\n    this._listeners = new Set();\n    this._effects = new Set();\n  }\n  _createClass(Event, [{\n    key: \"emit\",\n    value: function emit(data) {\n      for (var _i = 0, _Array$from = Array.from(this._listeners); _i < _Array$from.length; _i++) {\n        var listener = _Array$from[_i];\n        void this._trigger(listener, data);\n      }\n    }\n  }, {\n    key: \"on\",\n    value: function on(callback) {\n      var _this = this;\n      this._listeners.add(callback);\n      if (this.listenerCount() === 1) {\n        this._runEffects();\n      }\n      return function () {\n        return _this.off(callback);\n      };\n    }\n  }, {\n    key: \"off\",\n    value: function off(callback) {\n      this._listeners.delete(callback);\n      if (this.listenerCount() === 0) {\n        this._cleanupEffects();\n      }\n    }\n  }, {\n    key: \"listenerCount\",\n    value: function listenerCount() {\n      return this._listeners.size;\n    }\n  }, {\n    key: \"addEffect\",\n    value: function addEffect(effect) {\n      var _this2 = this;\n      var handle = {\n        effect: effect,\n        cleanup: undefined\n      };\n      if (this.listenerCount() > 0) {\n        var cleanup = handle.effect();\n        if (typeof cleanup === 'function') {\n          handle.cleanup = cleanup;\n        }\n      }\n      this._effects.add(handle);\n      return function () {\n        var _a;\n        // eslint-disable-next-line no-unused-expressions\n        (_a = handle.cleanup) === null || _a === void 0 ? void 0 : _a.call(handle);\n        _this2._effects.delete(handle);\n      };\n    }\n  }, {\n    key: \"_trigger\",\n    value: function _trigger(_x, _x2) {\n      return (_trigger2 = _trigger2 || _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(listener, data) {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return waitImmediate();\n            case 3:\n              // Acts like setImmediate but preserves the stack-trace.\n              listener(data);\n              _context.next = 9;\n              break;\n            case 6:\n              _context.prev = 6;\n              _context.t0 = _context[\"catch\"](0);\n              // Stop error propagation.\n              throwUnhandledRejection(_context.t0);\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 6]]);\n      }))).apply(this, arguments);\n    }\n  }, {\n    key: \"_runEffects\",\n    value: function _runEffects() {\n      for (var _i2 = 0, _Array$from2 = Array.from(this._effects); _i2 < _Array$from2.length; _i2++) {\n        var handle = _Array$from2[_i2];\n        var cleanup = handle.effect();\n        if (typeof cleanup === 'function') {\n          handle.cleanup = cleanup;\n        }\n      }\n    }\n  }, {\n    key: \"_cleanupEffects\",\n    value: function _cleanupEffects() {\n      var _a;\n      for (var _i3 = 0, _Array$from3 = Array.from(this._effects); _i3 < _Array$from3.length; _i3++) {\n        var handle = _Array$from3[_i3];\n        // eslint-disable-next-line no-unused-expressions\n        (_a = handle.cleanup) === null || _a === void 0 ? void 0 : _a.call(handle);\n        handle.cleanup = undefined;\n      }\n    }\n  }]);\n  return Event;\n}();\nfunction throwUnhandledRejection(error) {\n  setTimeout(function () {\n    throw error;\n  });\n}\n/**\n * Like setImmediate but for async/await API. Useful for preserving stack-traces.\n */\nvar waitImmediate = function waitImmediate() {\n  return new Promise(function (resolve) {\n    return setTimeout(resolve);\n  });\n};","map":{"version":3,"names":["Event","_trigger2","_classCallCheck","_listeners","Set","_effects","_createClass","key","value","emit","data","_i","_Array$from","Array","from","length","listener","_trigger","on","callback","_this","add","listenerCount","_runEffects","off","delete","_cleanupEffects","size","addEffect","effect","_this2","handle","cleanup","undefined","_a","call","_x","_x2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","waitImmediate","t0","throwUnhandledRejection","stop","apply","arguments","_i2","_Array$from2","_i3","_Array$from3","error","setTimeout","Promise","resolve"],"sources":["D:\\CC\\Server\\prototype\\node_modules\\@usedapp\\core\\src\\helpers\\event.ts"],"sourcesContent":["export type Effect = () => (() => void) | undefined | void\n\n/**\n * Effect that's been added to a specific Event.\n */\ninterface MaterializedEffect {\n  effect: Effect\n  cleanup: (() => void) | undefined\n}\n\nexport interface ReadOnlyEvent<T> {\n  on: (cb: (data: T) => void) => () => void\n  off: (cb: (data: T) => void) => void\n  emit: (data: T) => void\n  addEffect: (effect: Effect) => () => void\n}\n\nexport class Event<T = void> implements ReadOnlyEvent<T> {\n  private readonly _listeners = new Set<(data: T) => void>()\n  private readonly _effects = new Set<MaterializedEffect>()\n\n  emit(data: T) {\n    for (const listener of Array.from(this._listeners)) {\n      void this._trigger(listener, data)\n    }\n  }\n\n  on(callback: (data: T) => void): () => void {\n    this._listeners.add(callback)\n\n    if (this.listenerCount() === 1) {\n      this._runEffects()\n    }\n\n    return () => this.off(callback)\n  }\n\n  off(callback: (data: T) => void) {\n    this._listeners.delete(callback)\n\n    if (this.listenerCount() === 0) {\n      this._cleanupEffects()\n    }\n  }\n\n  listenerCount() {\n    return this._listeners.size\n  }\n\n  addEffect(effect: Effect): () => void {\n    const handle: MaterializedEffect = { effect, cleanup: undefined }\n\n    if (this.listenerCount() > 0) {\n      const cleanup = handle.effect()\n      if (typeof cleanup === 'function') {\n        handle.cleanup = cleanup\n      }\n    }\n\n    this._effects.add(handle)\n    return () => {\n      // eslint-disable-next-line no-unused-expressions\n      handle.cleanup?.()\n      this._effects.delete(handle)\n    }\n  }\n\n  private async _trigger(listener: (data: T) => void, data: T) {\n    try {\n      await waitImmediate() // Acts like setImmediate but preserves the stack-trace.\n      listener(data)\n    } catch (error: any) {\n      // Stop error propagation.\n      throwUnhandledRejection(error)\n    }\n  }\n\n  private _runEffects() {\n    for (const handle of Array.from(this._effects)) {\n      const cleanup = handle.effect()\n      if (typeof cleanup === 'function') {\n        handle.cleanup = cleanup\n      }\n    }\n  }\n\n  private _cleanupEffects() {\n    for (const handle of Array.from(this._effects)) {\n      // eslint-disable-next-line no-unused-expressions\n      handle.cleanup?.()\n      handle.cleanup = undefined\n    }\n  }\n}\n\nfunction throwUnhandledRejection(error: Error) {\n  setTimeout(() => {\n    throw error\n  })\n}\n\n/**\n * Like setImmediate but for async/await API. Useful for preserving stack-traces.\n */\nconst waitImmediate = () => new Promise((resolve) => setTimeout(resolve))\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}