{"ast":null,"code":"import _classCallCheck from \"D:/CC/Server/prototype/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"D:/CC/Server/prototype/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _regeneratorRuntime from \"D:/CC/Server/prototype/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"D:/CC/Server/prototype/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _getMetamaskProvider;\nimport { providers } from 'ethers';\nimport detectEthereumProvider from '@metamask/detect-provider';\nimport { Event } from '../../../../helpers/event';\nvar GET_METAMASK_LINK = 'https://metamask.io/download.html';\nexport function getMetamaskProvider() {\n  return (_getMetamaskProvider = _getMetamaskProvider || _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n    var _a, injectedProviders, injectedProvider, provider;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          if (window.ethereum) {\n            _context.next = 3;\n            break;\n          }\n          window.open(GET_METAMASK_LINK);\n          return _context.abrupt(\"return\", undefined);\n        case 3:\n          injectedProviders = (window === null || window === void 0 ? void 0 : window.ethereum.providers) || [];\n          if (!((_a = injectedProviders.find(function (provider) {\n            var _a;\n            return (_a = provider.isMetaMask) !== null && _a !== void 0 ? _a : false;\n          })) !== null && _a !== void 0)) {\n            _context.next = 8;\n            break;\n          }\n          _context.t0 = _a;\n          _context.next = 11;\n          break;\n        case 8:\n          _context.next = 10;\n          return detectEthereumProvider();\n        case 10:\n          _context.t0 = _context.sent;\n        case 11:\n          injectedProvider = _context.t0;\n          if (injectedProvider) {\n            _context.next = 15;\n            break;\n          }\n          console.log(\"Metamask is not installed - you can get it under \".concat(GET_METAMASK_LINK));\n          return _context.abrupt(\"return\", undefined);\n        case 15:\n          provider = new providers.Web3Provider(injectedProvider, 'any');\n          return _context.abrupt(\"return\", provider);\n        case 17:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }))).apply(this, arguments);\n}\nexport var MetamaskConnector = /*#__PURE__*/function (_init, _connectEagerly, _activate, _deactivate) {\n  function MetamaskConnector() {\n    _classCallCheck(this, MetamaskConnector);\n    this.name = 'Metamask';\n    this.update = new Event();\n  }\n  _createClass(MetamaskConnector, [{\n    key: \"init\",\n    value: function init() {\n      return (_init = _init || _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var metamask;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!this.provider) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 2:\n              _context2.next = 4;\n              return getMetamaskProvider();\n            case 4:\n              metamask = _context2.sent;\n              if (metamask) {\n                _context2.next = 7;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 7:\n              this.provider = metamask;\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }))).apply(this, arguments);\n    }\n  }, {\n    key: \"connectEagerly\",\n    value: function connectEagerly() {\n      return (_connectEagerly = _connectEagerly || _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var chainId, accounts;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return this.init();\n            case 2:\n              _context3.t0 = !this.provider;\n              if (_context3.t0) {\n                _context3.next = 8;\n                break;\n              }\n              _context3.next = 6;\n              return this.provider.send('wallet_getPermissions', []);\n            case 6:\n              _context3.t1 = _context3.sent.length;\n              _context3.t0 = _context3.t1 === 0;\n            case 8:\n              if (!_context3.t0) {\n                _context3.next = 11;\n                break;\n              }\n              this.provider = undefined;\n              return _context3.abrupt(\"return\");\n            case 11:\n              _context3.prev = 11;\n              _context3.next = 14;\n              return this.provider.send('eth_chainId', []);\n            case 14:\n              chainId = _context3.sent;\n              _context3.next = 17;\n              return this.provider.send('eth_accounts', []);\n            case 17:\n              accounts = _context3.sent;\n              this.update.emit({\n                chainId: parseInt(chainId),\n                accounts: accounts\n              });\n              _context3.next = 24;\n              break;\n            case 21:\n              _context3.prev = 21;\n              _context3.t2 = _context3[\"catch\"](11);\n              console.debug(_context3.t2);\n            case 24:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[11, 21]]);\n      }))).apply(this, arguments);\n    }\n  }, {\n    key: \"activate\",\n    value: function activate() {\n      return (_activate = _activate || _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var _a, chainId, accounts;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return this.init();\n            case 2:\n              if (this.provider) {\n                _context4.next = 4;\n                break;\n              }\n              throw new Error('Could not activate connector');\n            case 4:\n              _context4.prev = 4;\n              _context4.next = 7;\n              return this.provider.send('eth_chainId', []);\n            case 7:\n              chainId = _context4.sent;\n              _context4.next = 10;\n              return this.provider.send('eth_requestAccounts', []);\n            case 10:\n              accounts = _context4.sent;\n              this.update.emit({\n                chainId: parseInt(chainId),\n                accounts: accounts\n              });\n              _context4.next = 18;\n              break;\n            case 14:\n              _context4.prev = 14;\n              _context4.t0 = _context4[\"catch\"](4);\n              console.log(_context4.t0);\n              throw new Error('Could not activate connector: ' + ((_a = _context4.t0.message) !== null && _a !== void 0 ? _a : ''));\n            case 18:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[4, 14]]);\n      }))).apply(this, arguments);\n    }\n  }, {\n    key: \"deactivate\",\n    value: function deactivate() {\n      return (_deactivate = _deactivate || _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              this.provider = undefined;\n            case 1:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }))).apply(this, arguments);\n    }\n  }]);\n  return MetamaskConnector;\n}();","map":{"version":3,"names":["providers","detectEthereumProvider","Event","GET_METAMASK_LINK","getMetamaskProvider","_getMetamaskProvider","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_a","injectedProviders","injectedProvider","provider","wrap","_callee$","_context","prev","next","window","ethereum","open","abrupt","undefined","find","isMetaMask","t0","sent","console","log","concat","Web3Provider","stop","apply","arguments","MetamaskConnector","_init","_connectEagerly","_activate","_deactivate","_classCallCheck","name","update","_createClass","key","value","init","_callee2","metamask","_callee2$","_context2","connectEagerly","_callee3","chainId","accounts","_callee3$","_context3","send","t1","length","emit","parseInt","t2","debug","activate","_callee4","_callee4$","_context4","Error","message","deactivate","_callee5","_callee5$","_context5"],"sources":["D:\\CC\\Server\\prototype\\node_modules\\@usedapp\\core\\src\\providers\\network\\connectors\\implementations\\metamask.ts"],"sourcesContent":["import { Connector, ConnectorUpdateData } from '../connector'\nimport { providers } from 'ethers'\nimport detectEthereumProvider from '@metamask/detect-provider'\nimport { Event } from '../../../../helpers/event'\n\nconst GET_METAMASK_LINK = 'https://metamask.io/download.html'\n\nexport async function getMetamaskProvider() {\n  if (!(window as any).ethereum) {\n    window.open(GET_METAMASK_LINK)\n    return undefined\n  }\n\n  const injectedProviders: any[] = (window as any)?.ethereum.providers || []\n  const injectedProvider: any =\n    injectedProviders.find((provider) => {\n      return provider.isMetaMask ?? false\n    }) ?? (await detectEthereumProvider())\n\n  if (!injectedProvider) {\n    console.log(`Metamask is not installed - you can get it under ${GET_METAMASK_LINK}`)\n    return undefined\n  }\n\n  const provider = new providers.Web3Provider(injectedProvider, 'any')\n  return provider\n}\n\nexport class MetamaskConnector implements Connector {\n  public provider?: providers.Web3Provider\n  public readonly name = 'Metamask'\n\n  readonly update = new Event<ConnectorUpdateData>()\n\n  private async init() {\n    if (this.provider) return\n    const metamask = await getMetamaskProvider()\n    if (!metamask) {\n      return\n    }\n    this.provider = metamask\n  }\n\n  async connectEagerly(): Promise<void> {\n    await this.init()\n\n    if (!this.provider || (await this.provider.send('wallet_getPermissions', [])).length === 0) {\n      this.provider = undefined\n      return\n    }\n\n    try {\n      const chainId: string = await this.provider!.send('eth_chainId', [])\n      const accounts: string[] = await this.provider!.send('eth_accounts', [])\n      this.update.emit({ chainId: parseInt(chainId), accounts })\n    } catch (e) {\n      console.debug(e)\n    }\n  }\n\n  async activate(): Promise<void> {\n    await this.init()\n\n    if (!this.provider) {\n      throw new Error('Could not activate connector')\n    }\n\n    try {\n      const chainId: string = await this.provider!.send('eth_chainId', [])\n      const accounts: string[] = await this.provider!.send('eth_requestAccounts', [])\n      this.update.emit({ chainId: parseInt(chainId), accounts })\n    } catch (e: any) {\n      console.log(e)\n      throw new Error('Could not activate connector: ' + (e.message ?? ''))\n    }\n  }\n\n  async deactivate(): Promise<void> {\n    this.provider = undefined\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}